<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Rubik:ital,wght@0,300..900;1,300..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css" integrity="sha512-5Hs3dF2AEPkpNAR7UiOHba+lRSJNeM2ECkwxUIxC1Q/FLycGTbNapWXB4tP889k5T5Ju8fs4b1P5z/iB4nMfSQ==" crossorigin="anzonymous" referrerpolicy="no-referrer" />
    <script src="https://s3.tradingview.com/tv.js"></script>
    <link href="{% static 'assets/css/new.css' %}" rel="stylesheet" />
    
    <title>Dashboard</title>
    

    <!-- <style>


body {
    margin: 0;
    font-family: "Rubik", sans-serif;
    background: #111212;
}


.rubik{
    font-family: "Rubik", sans-serif;
    font-optical-sizing: auto;
    font-weight: weight;
    font-style: normal;
  }

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 20px;
    background-color:  #1F1F1F;
    color: white;
    font-family: "Rubik", sans-serif;
}

.title{
    color: #00E4A3;
    font-size: 20px;
}
.header .profile {
    position: relative;
    cursor: pointer;
}

.profile-icon {
    width: 30px;
    height: 30px;
    background-color: white;
    border-radius: 50%;
    overflow: hidden;
}

.profile-icon img{
    width: 100%;
    height: 100%;
    object-fit: cover;
}
.dropdown {
    display: none;
    position: absolute;
    z-index: 9999;
    top: 41px;
    right: 0;
    width: 130px;
    background-color: #1F1F1F;
    color: black;
    box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
    padding: 10px;
    border-radius: 3px;
}
.dropdown a {
    text-decoration: none;
    color: rgb(255, 255, 255);
    display: block;
    padding: 5px 0;
    font-family: "Rubik", sans-serif;
    transition: 0.3s ease-in-out;
}       

.dropdown a:hover{
    color: #00E4A3;
}

.content {
    display: flex;
    height: calc(100vh - 70px);
    padding: 10px;
}
.main {
    flex: 3;
    width: 100%;
    display: flex;
    flex-direction: column;
    margin-right: 5px;
}

.chart {
    flex: 2;
    background-color: #000000;
    box-shadow: rgba(14, 63, 126, 0.06) 0px 0px 0px 1px, rgba(42, 51, 70, 0.03) 0px 1px 1px -0.5px, rgba(42, 51, 70, 0.04) 0px 2px 2px -1px, rgba(42, 51, 70, 0.04) 0px 3px 3px -1.5px, rgba(42, 51, 70, 0.03) 0px 5px 5px -2.5px, rgba(42, 51, 70, 0.03) 0px 10px 10px -5px, rgba(42, 51, 70, 0.03) 0px 24px 24px -8px;
    margin-bottom: 5px;
    border-radius:5px;
    resize: both;
    overflow: auto;
}

.stock-info {
    flex: 1;
    background-color: #000000;
    box-shadow: rgba(14, 63, 126, 0.06) 0px 0px 0px 1px, rgba(42, 51, 70, 0.03) 0px 1px 1px -0.5px, rgba(42, 51, 70, 0.04) 0px 2px 2px -1px, rgba(42, 51, 70, 0.04) 0px 3px 3px -1.5px, rgba(42, 51, 70, 0.03) 0px 5px 5px -2.5px, rgba(42, 51, 70, 0.03) 0px 10px 10px -5px, rgba(42, 51, 70, 0.03) 0px 24px 24px -8px;
    resize: both;
    overflow: auto;
    margin-top: 10px;
    border-radius:5px;
}

.sidebar {
    /* flex: 1; */
    background-color: #ffffff;
    border-left: 1px solid #ccc;
    padding: 10px;
    /* overflow: auto; */
}

.watchlist {
    list-style: none;
    padding: 0;
}

.watchlist li {
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.watchlist li span {
    font-size: 14px;
    font-family: "Rubik", sans-serif;
}

.top-bar {
    display: flex;
    gap: 20px;
    background: #1f1f1f;
    padding-top: 5px;
    padding-right: 10px;
    padding-left: 10px;
    align-items: center;
    padding-bottom: 5px;
    color: #fff;
}
.serch-main {
    display: flex;
    justify-content: center;
    align-items: center;
}

.serch-main span{
    margin-left:5px;
}
  /* Search Section 1 (Left side) */
  .search1, .serach-2 {
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #00e497;
    position: relative;
    padding: 5px;
    border-radius: 5px;
    }

    button.dropdown-btn {
        padding: 0px;
        background: transparent;
        border: none;
        color: #fff;
        border-radius: 0;
        font-family: "Rubik", sans-serif;
    }
.search1 p, .serach-2 p {
    margin: 0;
    padding: 0;
    font-size: 20px;
    cursor: pointer;
}

.search1 span, .serach-2 span {
    font-size: 14px;
    color: #fff;
    font-weight: 100;
}

.serch-main {
    display: flex;
    align-items: center;
}

/* Dropdown Styles */
.serch-dropdown {
    display: none;
    position: absolute;
    background-color: white;
    width: 250px;
    left: 0;
    padding: 10px;
    border: none;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    border-radius: 5px;
    top: 40px;
}

/* Search Input with Icon */
.serch-dropdown input {
    width: 83%;
    padding: 10px;
    padding-left: 30px; /* Space for the search icon */
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 16px;
}

.serch-dropdown i {
    position: absolute;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 18px;
    color: #888;
}

.serch-dropdown button {
    width: 100%;
    padding: 10px;
    background-color: #28a745;
    color: white;
    border: none;
    cursor: pointer;
    border-radius: 5px;
}

.serch-dropdown button:hover {
    background-color: #218838;
}

/* Timer Section */
.timer {
    display: flex;
    align-items: center;
    position: relative;
}

.timer span {
    font-size: 20px;
    margin: 0 5px;
}

.timer select {
    padding: 5px;
    margin-left: 10px;
}

.timer span {
    font-size: 18px;
    margin: 0 5px;
    font-weight: 300;
}

.timer select {
    padding: 5px;
    margin-left: 10px;
    font-size: 14px;
    cursor: pointer;
}

.timer-dropdown {
    position: absolute;
    top: 35px;
    height: 265px;
    overflow: scroll;
    left: 0;
    background-color: white;
    border: 1px solid #ccc;
    width: 160px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    display: none;
    z-index: 999999999999;
}

.timer-dropdown option {
    padding: 10px;
    color: #000;
    cursor: pointer;
    font-size: 14px;
}
.search1 span {
    color: #fff;
}
.search-2 span {
    color: #fff;
}
.timer-dropdown option:hover {
    background-color: #f0f0f0;
}

.timer-dropdown .selected {
    color: gold;
}
.popup-container {
    position: fixed;
    top: 10%;
    left: 50%;
    transform: translateX(-50%);
    background-color:#1f1f1f;
    padding: 20px;
    width: 100%;
    max-width: 50%;
    border-radius: 8px;
    display: none;
    z-index: 1000;
}
.popup-header {
    font-size: 18px;
    color: white;
    margin-bottom: 10px;
}
.search-bar {
    width: 95%;
    padding: 10px;
    border: 1px solid #444;
    background-color: #2a2a3a;
    color: white;
    border-radius: 5px;
    font-size: 16px;
}
.symbol-list {
    margin-top: 10px;
    max-height: 200px;
    overflow-y: auto;
}
.symbol-item {
    padding: 8px;
    background-color: #333;
    color: white;
    border-radius: 5px;
    margin: 5px 0;
    cursor: pointer;
}
.symbol-item:hover {
    background-color: #444;
}

.bottom-bar p {
    margin: 0;
    font-size: 15px;
    cursor: pointer;
    font-weight: 300;
}
.row-content {
    display: flex;
    width: 100%;
    gap: 15px;
    justify-content: space-between;
}
.box-content {
    width: 33.33%;
    padding-left: 10px;
    padding-top: 5px;
    border-radius: 3px;
    padding-right: 10px;
    padding-bottom: 5px;
    color: #ffffff !important;
}
.box-content p {
    margin: 0;
    padding-bottom: 5px;
}
p.sm-text {
    font-size: 12px;
}
.box-content i {
    font-size: 12px;
}

i.fa-solid.fa-magnifying-glass {
    font-size: 15px;
}
.p-icon{
    display: flex;
    justify-content: center;
    align-items: center;
}
.top-bar.bottom-bar {
    padding-top: 15px;
    padding-bottom: 15px;
}

.table-container {
    width: 100%;
    overflow-x: auto;
  }
  
  table {
    width: 100%;
    border-collapse: collapse;
    background-color: #000000;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    color: #fff;
}
  
  th, td {
    text-align: left;
    padding: 12px 15px;
    border-bottom: 1px solid #ddd;
  }
  
  th {
    background-color: #000000;
    font-weight: 400;
  }
  

  .small-text {
    font-size: 0.85em;
    color: rgb(255, 0, 0);
  }
  
  td span {
    display: block;
  }

 
  
  .data-table {
    width: 100%;
    border-collapse: collapse;
    
    border-radius: 8px;
  }
  
  th, td {
    padding: 10px;
    text-align: center;
    border-bottom: 1px solid #555;
  }
  
  
  .negative-value {
    color: red;
  }
  
 
 
  
  thead th {
    color: #fff;
  }


   ::-webkit-scrollbar {
    width: 5px;
    height: 5px; 
  }

  
  ::-webkit-scrollbar-track {
    background: transparent;
    border-radius: 5px; 
  }

  ::-webkit-scrollbar-thumb {
    background: transparent; 
    border-radius: 5px;
  }


  ::-webkit-scrollbar-thumb:hover {
    background: transparent;
  }


    #content1 .row-content {
        overflow-x: auto; /* Enables horizontal scrolling */
        white-space: nowrap; /* Ensures the child elements don't wrap to the next line */
    }

    #content1 .box-content {
        display: inline-block; /* Makes each box sit next to each other horizontally */
        margin-right: 10px; /* Adds some space between boxes */
    }

    .tab-button {
    cursor: pointer;
  }
  .tab-button.active {
    color: #00e4a3;
}
    </style> -->
</head>
<body>


    <!-- popup container -->


    <div id="popup" class="popup-container" style="display: none;">
        <div class="popup-header">
            Symbol Search
            <button onclick="closePopup()" style="float: right; background-color:transparent; color:#00E4A3; border: none; padding: 5px 10px; cursor: pointer;"><i class="fa-solid fa-x"></i></button>
        </div>
        <input type="text" id="searchInput" class="search-bar" placeholder="Search for symbols..." onkeyup="filterSymbols()">
        <div class="symbol-list" id="symbolList">
            {% for s in symbols %}
            <div class="symbol-item" onclick="saveSymbolToDB('{{s}}')">{{s}}</div>
            {% endfor %}
            <!-- Add more symbols as needed -->
        </div>
    </div>


<div class="header">
    <div class="title">Dashboard</div>
    <div class="profile" id="profile">
        <div class="profile-icon">
            <img src="{% static 'assets/image/profile.webp' %}" alt="profile-image">
        </div>
        <div class="dropdown" id="dropdown">
            <a href="#">View Profile</a>
            <a href="../../../accounts/logout">Logout</a>
        </div>
    </div>
</div>

<div class="content">
    <div class="main">
        <div class="chart">
            <div class="graph-chart">
                <!-- Top Bar with Search and Timer -->
                <div class="top-bar">
                    <!-- Search 1 Section (Left) -->
                    <div class="search1">
                        <div class="serch-main" onclick="openPopup()">
                            <p class="p-icon"><i class="fa-solid fa-magnifying-glass"></i></p>
                            <span>{{portfolio.symbol}}</span>
                        </div>
                        <div class="serch-dropdown" id="search1-dropdown">
                            <input type="text" placeholder="Search...">
                            <button onclick="searchFunction()">Search</button>
                        </div>
                    </div>
        
                    <!-- Timer Section (Middle) -->
                    <div class="timer">
                        <span class="hour"></span>
                        <span class="min"></span>
                        <span class="sec"></span>
        
                        <button class="dropdown-btn" onclick="toggleTimerDropdown(event)">
                            {{interval_data}} <i class="fa fa-caret-down"></i>
                        </button>
                        <div class="timer-dropdown" id="timer-dropdown" >
                            <option value="1m">1 minute</option>
                            <option value="2m">2 minutes</option>
                            <option value="5m">5 minutes</option>
                            <option value="10m">10 minutes</option>
                            <option value="15m">15 minutes</option>
                            <option value="30m">30 minutes</option>
                            <option value="1h">1 hour</option>
                            <option value="1d">1 day</option>
                        </div>
                    </div>  
        
                    <!-- Search 2 Section (Right) -->
                    <div class="serach-2">
                        <div class="serch-main" onclick="openPopup()">
                            <p><i class="fa-solid fa-chart-bar"></i></p>
                            <span>Indicator</span>
                        </div>
                        <div class="serch-dropdown" id="search2-dropdown">
                            <input type="text" placeholder="Search...">
                            <button onclick="searchFunction()">Search</button>
                        </div>
                    </div>
                </div>
                    <div id="tradingview-widget-container"></div> 
            </div>
        </div>
        <div class="stock-info">
            <div class="top-bar bottom-bar">
              <p id="test1" class="tab-button active">Overview</p>
              <p id="test2" class="tab-button">List Of Trade</p> 
            </div>
            <div class="content-bottom">
              <div id="content1" class="content" style="display:none;">
                <div class="row-content">
                    <div class="box-content">
                        <p>Total Return <i class="fa-solid fa-circle-info"></i></p>
                        <p class="sm-text" style="color: {% if data_dict.Return < 0 %}red{% else %}#00e4a3{% endif %};">{{data_dict.Return}} %</p>
                    </div>
                    <div class="box-content">
                        <p>Total Close Trade <i class="fa-solid fa-circle-info"></i></p>
                        <p class="sm-text">{{data_dict.total_trades}}</p>
                    </div>
                    <div class="box-content">
                        <p>Best Trades <i class="fa-solid fa-circle-info"></i></p>
                        <p class="sm-text" style="color: {% if data_dict.best_trades < 0 %}red{% else %}#00e4a3{% endif %};">{{data_dict.best_trades}} %</p>
                    </div>
                    <div class="box-content">
                        <p>Buy Hold Return <i class="fa-solid fa-circle-info"></i></p>
                        <p class="sm-text" style="color: {% if data_dict.buy_hold_return < 0 %}red{% else %}#00e4a3{% endif %};">{{data_dict.buy_hold_return}} %</p>
                    </div>
                    <div class="box-content">
                        <p>Max Dropdown <i class="fa-solid fa-circle-info"></i></p>
                        <p class="sm-text" style="color: {% if data_dict.Max_dropdown < 0 %}red{% else %}#00e4a3{% endif %};">{{data_dict.Max_dropdown}} %</p>
                    </div>
                    
                    <div class="box-content">
                        <p>Win Rate <i class="fa-solid fa-circle-info"></i></p>
                        <p class="sm-text" style="color: {% if data_dict.win_rate < 0 %}red{% else %}#00e4a3{% endif %};">{{data_dict.win_rate}}%</p>
                    </div>
                    <div class="box-content">
                        <p>Max dropdown duration <i class="fa-solid fa-circle-info"></i></p>
                        <p class="sm-text">{{data_dict.max_dropdown_duration}}</p>
                    </div>
                    <div class="box-content">
                        <p>Average Dropdown duration <i class="fa-solid fa-circle-info"></i></p>
                        <p class="sm-text">{{data_dict.average_dropdown_duration}}</p>
                    </div>
                    <div class="box-content">
                        <p>Worst Trades <i class="fa-solid fa-circle-info"></i></p>
                        <p class="sm-text" style="color: {% if data_dict.worst_trades < 0 %}red{% else %}#00e4a3{% endif %};">{{data_dict.worst_trades}}</p>
                    </div>
                    <div class="box-content">
                        <p>Profit Factor <i class="fa-solid fa-circle-info"></i></p>
                        <p class="sm-text" style="color: {% if data_dict.profit_factor < 0 %}red{% else %}#00e4a3{% endif %};">{{data_dict.profit_factor}} %</p>
                    </div>
                </div>
              </div>
              <div id="content2" class="content" style="display:none;">
                <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>Entry Time</th>
                          <th>Exit Time</th>
                          <th>Entry Price</th>
                          <th>Exit Price</th>
                          <th>PnL</th>
                          <th>Returns</th>
                          <th>Duration</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for data in trades_data%}
                        <tr>
                          <td>{{data.EntryTime|date:"Y-m-d H:i:s"}}</td>
                          <td>{{data.ExitTime|date:"Y-m-d H:i:s"}}</td>
                          <td>{{data.EntryPrice}}</td>
                          <td>{{data.ExitPrice}}</td>
                          <td style="color: {% if data.PnL < 0 %}red{% else %}#00e4a3{% endif %};">{{data.PnL}}</td>
                          <td style="color: {% if data.ReturnPct < 0 %}red{% else %}#00e4a3{% endif %};">{{data.ReturnPct}}</td>
                          <td>{{data.Duration}}</td>
                        </tr>
                  {% endfor %}
                      </tbody>
                    </table>
                  </div>    
              </div>

            </div>
          </div>
          
    </div>
  
</div>

<script>



    const profile = document.getElementById('profile');
    const dropdown = document.getElementById('dropdown');

    profile.addEventListener('click', () => {
        dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
    });

    window.addEventListener('click', (event) => {
        if (!profile.contains(event.target)) {
            dropdown.style.display = 'none';
        }
    });
</script>


<script>

    function saveSymbolToDB(symbol) {
        console.log(symbol);
        fetch('../../admin/save-symbol/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCSRFToken(), 
            },
            body: JSON.stringify({ symbol: symbol })
        })
        .then(response => {
            if (response.ok) {
                location.reload(true);
                return response.json();
                

            } else {
                throw new Error('Failed to save symbol.');
            }
        })
        .then(data => {
            console.log('Symbol saved successfully:', data);
        })
        .catch(error => {
            console.error('Error saving symbol:', error);
        });
    }

</script>


<script>


function saveInterval(interval) {
    console.log(interval);
    fetch('/admin/save-interval/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCSRFToken() // Add CSRF token for security
        },
        body: JSON.stringify({ interval: interval })
    })
    .then(response => {
        if (response.ok) {
            location.reload(true);
            return response.json();
        } else {
            throw new Error('Failed to save interval');
        }
    })
    .then(data => {
        console.log('Interval saved:', data);
    })
    .catch(error => {
        console.error('Error:', error);
    });
}

</script>


<script>

    function toggleSearchDropdown(id) {
        const dropdown = document.getElementById(id);
        const isCurrentlyVisible = dropdown.style.display === 'block';
        

        closeAllDropdowns();
        
 
        if (!isCurrentlyVisible) {
            dropdown.style.display = 'block';
        }
    }

 
    function closeAllDropdowns() {
        const dropdowns = document.querySelectorAll('.serch-dropdown');
        dropdowns.forEach(dropdown => {
            dropdown.style.display = 'none';
        });
    }

    document.addEventListener('click', function(event) {
        const search1Dropdown = document.getElementById('search1-dropdown');
        const search2Dropdown = document.getElementById('search2-dropdown');
        

        if (!event.target.closest('.search1') && !event.target.closest('.serach-2')) {
            closeAllDropdowns();
        }
    });

    function searchFunction() {
        const searchQuery = event.target.previousElementSibling.value;
        alert('Searching for: ' + searchQuery);
    }

   
</script>


<script>
    // Function to toggle the timer dropdown
    function toggleTimerDropdown(event) {
        const dropdown = document.getElementById('timer-dropdown');
        dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        event.stopPropagation(); // Prevent the dropdown from closing when clicking inside
    }

    // Close the dropdown if clicked outside
    document.addEventListener('click', function(event) {
        const dropdown = document.getElementById('timer-dropdown');
        const button = document.querySelector('.dropdown-btn');
        if (!event.target.closest('.timer') && !event.target.closest('.dropdown-btn')) {
            dropdown.style.display = 'none';
        }
    });

    // Function to update the timer based on selected option
    function updateTimer(selectedOption) {
        const timerDisplay = document.querySelector('.timer');
        let hour = 0;
        let minute = 0;
        let second = 0;

        // Map the selected option to time
        if (selectedOption === '1m') {
            minute = 1;
        } else if (selectedOption === '2m') {
            minute = 2;
        } else if (selectedOption === '3m') {
            minute = 3;
        } else if (selectedOption === '5m') {
            minute = 5;
        } else if (selectedOption === '10m') {
            minute = 10;
        } else if (selectedOption === '15m') {
            minute = 15;
        } else if (selectedOption === '30m') {
            minute = 30;
        } else if (selectedOption === '1h') {
            hour = 1;
        } else if (selectedOption === '2h') {
            hour = 2;
        }else if (selectedOption === '4h') {
            hour = 4;
        }else if (selectedOption === '1d') {
            day = 1;
        }

        saveInterval(selectedOption);


        // Update the timer display
        document.querySelector('.hour').textContent = hour ? hour + 'h' : '';
        document.querySelector('.min').textContent = minute ? minute + 'm' : '';
        document.querySelector('.sec').textContent = second ? second : '';

        // Change the button text to show the selected time
        document.querySelector('.dropdown-btn').innerHTML = `${hour ? hour + ' hour' : ''} ${minute ? minute + ' minutes' : ''} <i class="fa fa-caret-down"></i>`;
    }

    // Set event listeners for the dropdown options
    const options = document.querySelectorAll('.timer-dropdown option');
    options.forEach(option => {
        option.addEventListener('click', function() {
            updateTimer(option.value);
            document.getElementById('timer-dropdown').style.display = 'none';
        });
    });
</script>

   <script>
        function openPopup() {
            document.getElementById('popup').style.display = 'block';
        }

        function filterSymbols() {
            const input = document.getElementById('searchInput').value.toLowerCase();
            const symbols = document.querySelectorAll('.symbol-item');

            symbols.forEach(symbol => {
                const symbolText = symbol.textContent.toLowerCase();
                if (symbolText.includes(input)) {
                    symbol.style.display = '';
                } else {
                    symbol.style.display = 'none';
                }
            });
        }
    </script>



<script>
    // Function to open the popup in the center of the screen
function openPopup() {
    const popup = document.getElementById('popup');
    popup.style.display = 'block';
    popup.style.position = 'fixed';
    popup.style.top = '50%';
    popup.style.left = '50%';
    popup.style.transform = 'translate(-50%, -50%)';
    popup.style.zIndex = '9999'; // Ensure it appears on top

    document.body.classList.add('blur');
}

// Function to close the popup
function closePopup() {
    const popup = document.getElementById('popup');
    popup.style.display = 'none';

    document.body.classList.remove('blur');

}

// Function to filter symbols in the popup
function filterSymbols() {
    const input = document.getElementById('searchInput').value.toLowerCase();
    const symbols = document.querySelectorAll('.symbol-item');

    symbols.forEach(symbol => {
        const symbolText = symbol.textContent.toLowerCase();
        if (symbolText.includes(input)) {
            symbol.style.display = '';
        } else {
            symbol.style.display = 'none';
        }
    });
}
</script>

<!-- <script>
document.addEventListener("DOMContentLoaded", function () {
  document.getElementById("content1").style.display = "block";
  document.getElementById("content2").style.display = "none";
  document.getElementById("test1").classList.add("active");
});

function setActiveTab(clickedTab, contentToShow) {
  document.querySelectorAll(".tab-button").forEach(button => {
    button.classList.remove("active");
  });
  clickedTab.classList.add("active");
  document.getElementById("content1").style.display = "none";
  document.getElementById("content2").style.display = "none";
  document.getElementById(contentToShow).style.display = "block";
}
document.getElementById("test1").addEventListener("click", function () {
  setActiveTab(this, "content1");
});
document.getElementById("test2").addEventListener("click", function () {
  setActiveTab(this, "content2");
});
</script> -->
  
<script>
    document.addEventListener("DOMContentLoaded", function () {
      document.getElementById("content1").style.display = "block";
      document.getElementById("content2").style.display = "none";
      document.getElementById("test1").classList.add("active");
    });
    
    function setActiveTab(clickedTab, contentToShow) {
      // Remove 'active' class and reset color for all tabs
      document.querySelectorAll(".tab-button").forEach(button => {
        button.classList.remove("active");
      });
      
      // Add 'active' class and set color for the clicked tab
      clickedTab.classList.add("active");
    
      // Hide all content and show only the selected tab's content
      document.getElementById("content1").style.display = "none";
      document.getElementById("content2").style.display = "none";
      document.getElementById(contentToShow).style.display = "block";
    }
    
    // Event listeners for tabs
    document.getElementById("test1").addEventListener("click", function () {
      setActiveTab(this, "content1");
    });
    document.getElementById("test2").addEventListener("click", function () {
      setActiveTab(this, "content2");
    });
    </script>
    

<script>
    let symbol = "MSFT";
    let interval = "30";

    new TradingView.widget({
        width: "100%",
        height: "100%",
        symbol: "{{ portfolio.symbol|escapejs }}",
        interval: "{{ portfolio.interval|escapejs }}",
        timezone: "Etc/UTC",
        theme: "dark",
        style: "1",
        locale: "en",
        toolbar_bg: "#f1f3f6",
        enable_publishing: true,
        allow_symbol_change: true,
        container_id: "tradingview-widget-container",
        hide_side_toolbar: true,
        hide_top_toolbar :true,
        studies: [
            "MACD",
            "RSI",
            "Moving Average"
        ],
        show_popup_button: false,
        popup_width: "1000",
        popup_height: "650",
        withdateranges: true,
        watchlist: [],
        custom_css_url: "",
        debug: false,
        autosize: false,
        isTransparent: false,
        details: true,
        news: ["headlines"],
        hide_legend: false,
        save_image: false,
    });
</script>
<script>
function openPopup() {
    document.getElementById('popup').style.display = 'block';
}

function closePopup() {
    document.getElementById('popup').style.display = 'none';
}

function filterSymbols() {
    const input = document.getElementById('searchInput').value.toLowerCase();
    const symbols = document.querySelectorAll('.symbol-item');

    symbols.forEach(symbol => {
        const text = symbol.textContent.toLowerCase();
        symbol.style.display = text.includes(input) ? 'block' : 'none';
    });
}

function selectSymbol(symbolText) {
    const activeSearchMain = document.querySelector('.serch-main.active');
    if (activeSearchMain) {
        const spanElement = activeSearchMain.querySelector('span');
        if (spanElement) {
            spanElement.textContent = symbolText;
        }
    }

    closePopup();
}

const symbolItems = document.querySelectorAll('.symbol-item');
symbolItems.forEach(item => {
    item.addEventListener('click', function () {
        const symbolText = this.textContent.split(' - ')[0]; // Get the symbol code (e.g., MSFT)
        selectSymbol(symbolText);
    });
});

const searchMainDivs = document.querySelectorAll('.serch-main');
searchMainDivs.forEach(div => {
    div.addEventListener('click', function () {
        searchMainDivs.forEach(d => d.classList.remove('active'));
        this.classList.add('active');
        openPopup();
    });
});



function getCSRFToken() {
        const cookieValue = document.cookie.split('; ').find(row => row.startsWith('csrftoken='));
        return cookieValue ? cookieValue.split('=')[1] : '';
}

</script>
</body>
</html>
